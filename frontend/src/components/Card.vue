<script setup lang="ts">
import { computed, onMounted, ref, watch } from 'vue';
import { useDraggable } from '@vueuse/core';
import { storeToRefs } from 'pinia';
import type { Card } from '@/models/Card';
import { useCardMove } from '@/composables/useCardMove';
import { useJudgementGame } from '@/composables/useJudgementGame';

const props = defineProps<{
  card: Card | undefined
  offsetCoeff: number
  index: number
  rotation: number
}>();

const emit = defineEmits<{
  (e: 'onMouseDown', card: Card, index: number): void
}>();

const twClasses: string[] = [
  'rotate-[-65deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[0deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-22deg]', 'rotate-[21deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-33deg]', 'rotate-[0deg]', 'rotate-[32deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-39deg]', 'rotate-[-13deg]', 'rotate-[13deg]', 'rotate-[39deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-44deg]', 'rotate-[-22deg]', 'rotate-[0deg]', 'rotate-[21deg]', 'rotate-[43deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-47deg]', 'rotate-[-28deg]', 'rotate-[-10deg]', 'rotate-[9deg]', 'rotate-[27deg]', 'rotate-[46deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-49deg]', 'rotate-[-33deg]', 'rotate-[-17deg]', 'rotate-[0deg]', 'rotate-[16deg]', 'rotate-[32deg]', 'rotate-[48deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-51deg]', 'rotate-[-37deg]', 'rotate-[-22deg]', 'rotate-[-8deg]', 'rotate-[7deg]', 'rotate-[21deg]', 'rotate-[36deg]', 'rotate-[50deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-52deg]', 'rotate-[-39deg]', 'rotate-[-26deg]', 'rotate-[-13deg]', 'rotate-[0deg]', 'rotate-[13deg]', 'rotate-[39deg]', 'rotate-[52deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-54deg]', 'rotate-[-42deg]', 'rotate-[-30deg]', 'rotate-[-18deg]', 'rotate-[-6deg]', 'rotate-[5deg]', 'rotate-[17deg]', 'rotate-[29deg]', 'rotate-[41deg]', 'rotate-[53deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-55deg]', 'rotate-[-44deg]', 'rotate-[-33deg]', 'rotate-[-22deg]', 'rotate-[-11deg]', 'rotate-[0deg]', 'rotate-[10deg]', 'rotate-[21deg]', 'rotate-[32deg]', 'rotate-[43deg]', 'rotate-[54deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-55deg]', 'rotate-[-45deg]', 'rotate-[-35deg]', 'rotate-[-25deg]', 'rotate-[-15deg]', 'rotate-[-5deg]', 'rotate-[5deg]', 'rotate-[15deg]', 'rotate-[25deg]', 'rotate-[35deg]', 'rotate-[45deg]', 'rotate-[55deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-56deg]', 'rotate-[-47deg]', 'rotate-[-38deg]', 'rotate-[-28deg]', 'rotate-[-19deg]', 'rotate-[-10deg]', 'rotate-[0deg]', 'rotate-[9deg]', 'rotate-[18deg]', 'rotate-[27deg]', 'rotate-[37deg]', 'rotate-[46deg]', 'rotate-[55deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-57deg]', 'rotate-[-48deg]', 'rotate-[-39deg]', 'rotate-[-31deg]', 'rotate-[-22deg]', 'rotate-[-13deg]', 'rotate-[-5deg]', 'rotate-[4deg]', 'rotate-[13deg]', 'rotate-[21deg]', 'rotate-[30deg]', 'rotate-[39deg]', 'rotate-[47deg]', 'rotate-[56deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-57deg]', 'rotate-[-49deg]', 'rotate-[-41deg]', 'rotate-[-33deg]', 'rotate-[-25deg]', 'rotate-[-17deg]', 'rotate-[-9deg]', 'rotate-[0deg]', 'rotate-[8deg]', 'rotate-[16deg]', 'rotate-[24deg]', 'rotate-[32deg]', 'rotate-[40deg]', 'rotate-[48deg]', 'rotate-[56deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-58deg]', 'rotate-[-50deg]', 'rotate-[-43deg]', 'rotate-[-35deg]', 'rotate-[-27deg]', 'rotate-[-20deg]', 'rotate-[-12deg]', 'rotate-[-4deg]', 'rotate-[3deg]', 'rotate-[11deg]', 'rotate-[19deg]', 'rotate-[26deg]', 'rotate-[34deg]', 'rotate-[42deg]', 'rotate-[49deg]', 'rotate-[57deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-58deg]', 'rotate-[-51deg]', 'rotate-[-44deg]', 'rotate-[-37deg]', 'rotate-[-29deg]', 'rotate-[-22deg]', 'rotate-[-15deg]', 'rotate-[-8deg]', 'rotate-[0deg]', 'rotate-[7deg]', 'rotate-[14deg]', 'rotate-[21deg]', 'rotate-[28deg]', 'rotate-[36deg]', 'rotate-[43deg]', 'rotate-[50deg]', 'rotate-[57deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-59deg]', 'rotate-[-52deg]', 'rotate-[-45deg]', 'rotate-[-38deg]', 'rotate-[-31deg]', 'rotate-[-24deg]', 'rotate-[-18deg]', 'rotate-[-11deg]', 'rotate-[-4deg]', 'rotate-[3deg]', 'rotate-[10deg]', 'rotate-[17deg]', 'rotate-[23deg]', 'rotate-[30deg]', 'rotate-[37deg]', 'rotate-[44deg]', 'rotate-[51deg]', 'rotate-[58deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-59deg]', 'rotate-[-52deg]', 'rotate-[-46deg]', 'rotate-[-39deg]', 'rotate-[-33deg]', 'rotate-[-26deg]', 'rotate-[-20deg]', 'rotate-[-13deg]', 'rotate-[-7deg]', 'rotate-[0deg]', 'rotate-[6deg]', 'rotate-[13deg]', 'rotate-[19deg]', 'rotate-[26deg]', 'rotate-[32deg]', 'rotate-[39deg]', 'rotate-[45deg]', 'rotate-[52deg]', 'rotate-[58deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-59deg]', 'rotate-[-53deg]', 'rotate-[-47deg]', 'rotate-[-41deg]', 'rotate-[-35deg]', 'rotate-[-28deg]', 'rotate-[-22deg]', 'rotate-[-16deg]', 'rotate-[-10deg]', 'rotate-[-4deg]', 'rotate-[3deg]', 'rotate-[9deg]', 'rotate-[15deg]', 'rotate-[21deg]', 'rotate-[27deg]', 'rotate-[34deg]', 'rotate-[40deg]', 'rotate-[46deg]', 'rotate-[52deg]', 'rotate-[58deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-60deg]', 'rotate-[-54deg]', 'rotate-[-48deg]', 'rotate-[-42deg]', 'rotate-[-36deg]', 'rotate-[-30deg]', 'rotate-[-24deg]', 'rotate-[-18deg]', 'rotate-[-12deg]', 'rotate-[-6deg]', 'rotate-[0deg]', 'rotate-[5deg]', 'rotate-[11deg]', 'rotate-[17deg]', 'rotate-[23deg]', 'rotate-[29deg]', 'rotate-[35deg]', 'rotate-[41deg]', 'rotate-[47deg]', 'rotate-[53deg]', 'rotate-[59deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-60deg]', 'rotate-[-54deg]', 'rotate-[-49deg]', 'rotate-[-43deg]', 'rotate-[-37deg]', 'rotate-[-32deg]', 'rotate-[-26deg]', 'rotate-[-20deg]', 'rotate-[-15deg]', 'rotate-[-9deg]', 'rotate-[-3deg]', 'rotate-[2deg]', 'rotate-[8deg]', 'rotate-[14deg]', 'rotate-[19deg]', 'rotate-[25deg]', 'rotate-[31deg]', 'rotate-[36deg]', 'rotate-[42deg]', 'rotate-[48deg]', 'rotate-[53deg]', 'rotate-[59deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-60deg]', 'rotate-[-55deg]', 'rotate-[-49deg]', 'rotate-[-44deg]', 'rotate-[-38deg]', 'rotate-[-33deg]', 'rotate-[-28deg]', 'rotate-[-22deg]', 'rotate-[-17deg]', 'rotate-[-11deg]', 'rotate-[-6deg]', 'rotate-[0deg]', 'rotate-[5deg]', 'rotate-[10deg]', 'rotate-[16deg]', 'rotate-[21deg]', 'rotate-[27deg]', 'rotate-[32deg]', 'rotate-[37deg]', 'rotate-[43deg]', 'rotate-[48deg]', 'rotate-[54deg]', 'rotate-[59deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-60deg]', 'rotate-[-55deg]', 'rotate-[-50deg]', 'rotate-[45deg]', 'rotate-[-39deg]', 'rotate-[-34deg]', 'rotate-[-29deg]', 'rotate-[-24deg]', 'rotate-[-19deg]', 'rotate-[-13deg]', 'rotate-[-8deg]', 'rotate-[-3deg]', 'rotate-[2deg]', 'rotate-[7deg]', 'rotate-[13deg]', 'rotate-[18deg]', 'rotate-[23deg]', 'rotate-[28deg]', 'rotate-[33deg]', 'rotate-[39deg]', 'rotate-[44deg]', 'rotate-[49deg]', 'rotate-[54deg]', 'rotate-[59deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-60deg]', 'rotate-[-55deg]', 'rotate-[-50deg]', 'rotate-[-45deg]', 'rotate-[-40deg]', 'rotate-[-35deg]', 'rotate-[-30deg]', 'rotate-[-25deg]', 'rotate-[-20deg]', 'rotate-[-15deg]', 'rotate-[-10deg]', 'rotate-[-5deg]', 'rotate-[0deg]', 'rotate-[5deg]', 'rotate-[10deg]', 'rotate-[15deg]', 'rotate-[20deg]', 'rotate-[25deg]', 'rotate-[30deg]', 'rotate-[35deg]', 'rotate-[40deg]', 'rotate-[45deg]', 'rotate-[50deg]', 'rotate-[55deg]', 'rotate-[60deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-61deg]', 'rotate-[-56deg]', 'rotate-[-51deg]', 'rotate-[-46deg]', 'rotate-[-41deg]', 'rotate-[-37deg]', 'rotate-[-32deg]', 'rotate-[-27deg]', 'rotate-[-22deg]', 'rotate-[-17deg]', 'rotate-[-13deg]', 'rotate-[-8deg]', 'rotate-[-3deg]', 'rotate-[2deg]', 'rotate-[7deg]', 'rotate-[12deg]', 'rotate-[16deg]', 'rotate-[21deg]', 'rotate-[26deg]', 'rotate-[31deg]', 'rotate-[36deg]', 'rotate-[40deg]', 'rotate-[45deg]', 'rotate-[50deg]', 'rotate-[55deg]', 'rotate-[60deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-61deg]', 'rotate-[-56deg]', 'rotate-[-52deg]', 'rotate-[-47deg]', 'rotate-[-42deg]', 'rotate-[-38deg]', 'rotate-[-33deg]', 'rotate-[-28deg]', 'rotate-[-24deg]', 'rotate-[-19deg]', 'rotate-[-14deg]', 'rotate-[-10deg]', 'rotate-[-5deg]', 'rotate-[0deg]', 'rotate-[4deg]', 'rotate-[9deg]', 'rotate-[13deg]', 'rotate-[18deg]', 'rotate-[23deg]', 'rotate-[27deg]', 'rotate-[32deg]', 'rotate-[37deg]', 'rotate-[41deg]', 'rotate-[46deg]', 'rotate-[51deg]', 'rotate-[55deg]', 'rotate-[60deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-61deg]', 'rotate-[-57deg]', 'rotate-[-52deg]', 'rotate-[-48deg]', 'rotate-[-43deg]', 'rotate-[-39deg]', 'rotate-[-34deg]', 'rotate-[-30deg]', 'rotate-[-25deg]', 'rotate-[-21deg]', 'rotate-[-16deg]', 'rotate-[-12deg]', 'rotate-[-7deg]', 'rotate-[-3deg]', 'rotate-[2deg]', 'rotate-[6deg]', 'rotate-[11deg]', 'rotate-[15deg]', 'rotate-[20deg]', 'rotate-[24deg]', 'rotate-[29deg]', 'rotate-[33deg]', 'rotate-[38deg]', 'rotate-[42deg]', 'rotate-[47deg]', 'rotate-[51deg]', 'rotate-[56deg]', 'rotate-[60deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-61deg]', 'rotate-[-57deg]', 'rotate-[-52deg]', 'rotate-[-48deg]', 'rotate-[-44deg]', 'rotate-[-39deg]', 'rotate-[-35deg]', 'rotate-[-31deg]', 'rotate-[-26deg]', 'rotate-[-22deg]', 'rotate-[-18deg]', 'rotate-[-13deg]', 'rotate-[-9deg]', 'rotate-[-5deg]', 'rotate-[0deg]', 'rotate-[4deg]', 'rotate-[8deg]', 'rotate-[13deg]', 'rotate-[17deg]', 'rotate-[21deg]', 'rotate-[26deg]', 'rotate-[30deg]', 'rotate-[34deg]', 'rotate-[39deg]', 'rotate-[43deg]', 'rotate-[47deg]', 'rotate-[52deg]', 'rotate-[56deg]', 'rotate-[60deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-61deg]', 'rotate-[-57deg]', 'rotate-[-53deg]', 'rotate-[-49deg]', 'rotate-[-45deg]', 'rotate-[-40deg]', 'rotate-[-36deg]', 'rotate-[-32deg]', 'rotate-[-28deg]', 'rotate-[-24deg]', 'rotate-[-19deg]', 'rotate-[-15deg]', 'rotate-[-11deg]', 'rotate-[-7deg]', 'rotate-[-3deg]', 'rotate-[2deg]', 'rotate-[6deg]', 'rotate-[10deg]', 'rotate-[14deg]', 'rotate-[18deg]', 'rotate-[23deg]', 'rotate-[27deg]', 'rotate-[31deg]', 'rotate-[35deg]', 'rotate-[39deg]', 'rotate-[44deg]', 'rotate-[48deg]', 'rotate-[52deg]', 'rotate-[56deg]', 'rotate-[60deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-61deg]', 'rotate-[-57deg]', 'rotate-[-53deg]', 'rotate-[-49deg]', 'rotate-[-45deg]', 'rotate-[-41deg]', 'rotate-[-37deg]', 'rotate-[-33deg]', 'rotate-[-29deg]', 'rotate-[-25deg]', 'rotate-[-21deg]', 'rotate-[-17deg]', 'rotate-[-13deg]', 'rotate-[-9deg]', 'rotate-[-5deg]', 'rotate-[0deg]', 'rotate-[4deg]', 'rotate-[8deg]', 'rotate-[12deg]', 'rotate-[16deg]', 'rotate-[20deg]', 'rotate-[24deg]', 'rotate-[28deg]', 'rotate-[32deg]', 'rotate-[36deg]', 'rotate-[40deg]', 'rotate-[44deg]', 'rotate-[48deg]', 'rotate-[52deg]', 'rotate-[56deg]', 'rotate-[60deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-62deg]', 'rotate-[-58deg]', 'rotate-[-54deg]', 'rotate-[-50deg]', 'rotate-[-46deg]', 'rotate-[-42deg]', 'rotate-[-38deg]', 'rotate-[-34deg]', 'rotate-[-30deg]', 'rotate-[-26deg]', 'rotate-[-22deg]', 'rotate-[-18deg]', 'rotate-[-14deg]', 'rotate-[-10deg]', 'rotate-[-6deg]', 'rotate-[-2deg]', 'rotate-[1deg]', 'rotate-[5deg]', 'rotate-[9deg]', 'rotate-[13deg]', 'rotate-[17deg]', 'rotate-[21deg]', 'rotate-[25deg]', 'rotate-[29deg]', 'rotate-[33deg]', 'rotate-[37deg]', 'rotate-[41deg]', 'rotate-[45deg]', 'rotate-[49deg]', 'rotate-[53deg]', 'rotate-[57deg]', 'rotate-[61deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-62deg]', 'rotate-[-58deg]', 'rotate-[-54deg]', 'rotate-[-50deg]', 'rotate-[-46deg]', 'rotate-[-43deg]', 'rotate-[-39deg]', 'rotate-[-35deg]', 'rotate-[-31deg]', 'rotate-[-27deg]', 'rotate-[-23deg]', 'rotate-[-20deg]', 'rotate-[-16deg]', 'rotate-[-12deg]', 'rotate-[-8deg]', 'rotate-[-4deg]', 'rotate-[0deg]', 'rotate-[3deg]', 'rotate-[7deg]', 'rotate-[11deg]', 'rotate-[15deg]', 'rotate-[19deg]', 'rotate-[22deg]', 'rotate-[26deg]', 'rotate-[30deg]', 'rotate-[34deg]', 'rotate-[38deg]', 'rotate-[42deg]', 'rotate-[45deg]', 'rotate-[49deg]', 'rotate-[53deg]', 'rotate-[57deg]', 'rotate-[61deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-62deg]', 'rotate-[-58deg]', 'rotate-[-54deg]', 'rotate-[-51deg]', 'rotate-[-47deg]', 'rotate-[-43deg]', 'rotate-[-39deg]', 'rotate-[-36deg]', 'rotate-[-32deg]', 'rotate-[-28deg]', 'rotate-[-25deg]', 'rotate-[-21deg]', 'rotate-[-17deg]', 'rotate-[-13deg]', 'rotate-[-10deg]', 'rotate-[-6deg]', 'rotate-[-2deg]', 'rotate-[1deg]', 'rotate-[5deg]', 'rotate-[9deg]', 'rotate-[13deg]', 'rotate-[16deg]', 'rotate-[20deg]', 'rotate-[24deg]', 'rotate-[27deg]', 'rotate-[31deg]', 'rotate-[35deg]', 'rotate-[39deg]', 'rotate-[42deg]', 'rotate-[46deg]', 'rotate-[50deg]', 'rotate-[53deg]', 'rotate-[57deg]', 'rotate-[61deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-62deg]', 'rotate-[-58deg]', 'rotate-[-55deg]', 'rotate-[-51deg]', 'rotate-[-47deg]', 'rotate-[-44deg]', 'rotate-[-40deg]', 'rotate-[-37deg]', 'rotate-[-33deg]', 'rotate-[-29deg]', 'rotate-[-26deg]', 'rotate-[-22deg]', 'rotate-[-19deg]', 'rotate-[-15deg]', 'rotate-[-11deg]', 'rotate-[-8deg]', 'rotate-[-4deg]', 'rotate-[0deg]', 'rotate-[3deg]', 'rotate-[7deg]', 'rotate-[10deg]', 'rotate-[14deg]', 'rotate-[18deg]', 'rotate-[21deg]', 'rotate-[25deg]', 'rotate-[28deg]', 'rotate-[32deg]', 'rotate-[36deg]', 'rotate-[39deg]', 'rotate-[43deg]', 'rotate-[46deg]', 'rotate-[50deg]', 'rotate-[54deg]', 'rotate-[57deg]', 'rotate-[61deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-62deg]', 'rotate-[-58deg]', 'rotate-[-55deg]', 'rotate-[-51deg]', 'rotate-[-48deg]', 'rotate-[-44deg]', 'rotate-[-41deg]', 'rotate-[-37deg]', 'rotate-[-34deg]', 'rotate-[-30deg]', 'rotate-[-27deg]', 'rotate-[-23deg]', 'rotate-[-20deg]', 'rotate-[-16deg]', 'rotate-[-13deg]', 'rotate-[-9deg]', 'rotate-[-6deg]', 'rotate-[-2deg]', 'rotate-[1deg]', 'rotate-[5deg]', 'rotate-[8deg]', 'rotate-[12deg]', 'rotate-[15deg]', 'rotate-[19deg]', 'rotate-[22deg]', 'rotate-[26deg]', 'rotate-[29deg]', 'rotate-[33deg]', 'rotate-[36deg]', 'rotate-[40deg]', 'rotate-[43deg]', 'rotate-[47deg]', 'rotate-[50deg]', 'rotate-[54deg]', 'rotate-[57deg]', 'rotate-[61deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-62deg]', 'rotate-[-59deg]', 'rotate-[-55deg]', 'rotate-[-52deg]', 'rotate-[-48deg]', 'rotate-[-45deg]', 'rotate-[-42deg]', 'rotate-[-38deg]', 'rotate-[-35deg]', 'rotate-[-31deg]', 'rotate-[-28deg]', 'rotate-[-24deg]', 'rotate-[-21deg]', 'rotate-[-18deg]', 'rotate-[-14deg]', 'rotate-[-11deg]', 'rotate-[-7deg]', 'rotate-[-4deg]', 'rotate-[0deg]', 'rotate-[3deg]', 'rotate-[6deg]', 'rotate-[10deg]', 'rotate-[13deg]', 'rotate-[17deg]', 'rotate-[20deg]', 'rotate-[23deg]', 'rotate-[27deg]', 'rotate-[30deg]', 'rotate-[34deg]', 'rotate-[37deg]', 'rotate-[41deg]', 'rotate-[44deg]', 'rotate-[47deg]', 'rotate-[51deg]', 'rotate-[54deg]', 'rotate-[58deg]', 'rotate-[61deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-62deg]', 'rotate-[-59deg]', 'rotate-[-55deg]', 'rotate-[-52deg]', 'rotate-[-49deg]', 'rotate-[-45deg]', 'rotate-[-42deg]', 'rotate-[-39deg]', 'rotate-[-35deg]', 'rotate-[-32deg]', 'rotate-[-29deg]', 'rotate-[-25deg]', 'rotate-[-22deg]', 'rotate-[-19deg]', 'rotate-[-15deg]', 'rotate-[-12deg]', 'rotate-[-9deg]', 'rotate-[-5deg]', 'rotate-[-2deg]', 'rotate-[1deg]', 'rotate-[5deg]', 'rotate-[8deg]', 'rotate-[11deg]', 'rotate-[15deg]', 'rotate-[18deg]', 'rotate-[21deg]', 'rotate-[25deg]', 'rotate-[28deg]', 'rotate-[31deg]', 'rotate-[35deg]', 'rotate-[38deg]', 'rotate-[41deg]', 'rotate-[45deg]', 'rotate-[48deg]', 'rotate-[51deg]', 'rotate-[55deg]', 'rotate-[58deg]', 'rotate-[61deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-62deg]', 'rotate-[-59deg]', 'rotate-[-56deg]', 'rotate-[-52deg]', 'rotate-[-49deg]', 'rotate-[-46deg]', 'rotate-[-43deg]', 'rotate-[-39deg]', 'rotate-[-36deg]', 'rotate-[-33deg]', 'rotate-[-30deg]', 'rotate-[-26deg]', 'rotate-[-23deg]', 'rotate-[-20deg]', 'rotate-[-17deg]', 'rotate-[-13deg]', 'rotate-[-10deg]', 'rotate-[-7deg]', 'rotate-[-4deg]', 'rotate-[0deg]', 'rotate-[3deg]', 'rotate-[6deg]', 'rotate-[9deg]', 'rotate-[13deg]', 'rotate-[16deg]', 'rotate-[19deg]', 'rotate-[22deg]', 'rotate-[26deg]', 'rotate-[29deg]', 'rotate-[32deg]', 'rotate-[35deg]', 'rotate-[39deg]', 'rotate-[42deg]', 'rotate-[45deg]', 'rotate-[48deg]', 'rotate-[52deg]', 'rotate-[55deg]', 'rotate-[58deg]', 'rotate-[61deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-62deg]', 'rotate-[-59deg]', 'rotate-[-56deg]', 'rotate-[-53deg]', 'rotate-[-50deg]', 'rotate-[-46deg]', 'rotate-[-43deg]', 'rotate-[-40deg]', 'rotate-[-37deg]', 'rotate-[-34deg]', 'rotate-[-31deg]', 'rotate-[-27deg]', 'rotate-[-24deg]', 'rotate-[-21deg]', 'rotate-[-18deg]', 'rotate-[-15deg]', 'rotate-[-12deg]', 'rotate-[-8deg]', 'rotate-[-5deg]', 'rotate-[-2deg]', 'rotate-[1deg]', 'rotate-[4deg]', 'rotate-[7deg]', 'rotate-[11deg]', 'rotate-[14deg]', 'rotate-[17deg]', 'rotate-[20deg]', 'rotate-[23deg]', 'rotate-[26deg]', 'rotate-[30deg]', 'rotate-[33deg]', 'rotate-[36deg]', 'rotate-[39deg]', 'rotate-[42deg]', 'rotate-[45deg]', 'rotate-[49deg]', 'rotate-[52deg]', 'rotate-[55deg]', 'rotate-[58deg]', 'rotate-[61deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-62deg]', 'rotate-[-59deg]', 'rotate-[-56deg]', 'rotate-[-53deg]', 'rotate-[-50deg]', 'rotate-[-47deg]', 'rotate-[-44deg]', 'rotate-[-41deg]', 'rotate-[-38deg]', 'rotate-[-35deg]', 'rotate-[-31deg]', 'rotate-[-28deg]', 'rotate-[-25deg]', 'rotate-[-22deg]', 'rotate-[-19deg]', 'rotate-[-16deg]', 'rotate-[-13deg]', 'rotate-[-10deg]', 'rotate-[-7deg]', 'rotate-[-4deg]', 'rotate-[0deg]', 'rotate-[3deg]', 'rotate-[6deg]', 'rotate-[9deg]', 'rotate-[12deg]', 'rotate-[15deg]', 'rotate-[18deg]', 'rotate-[21deg]', 'rotate-[24deg]', 'rotate-[27deg]', 'rotate-[30deg]', 'rotate-[34deg]', 'rotate-[37deg]', 'rotate-[40deg]', 'rotate-[43deg]', 'rotate-[46deg]', 'rotate-[49deg]', 'rotate-[52deg]', 'rotate-[55deg]', 'rotate-[58deg]', 'rotate-[61deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-62deg]', 'rotate-[-59deg]', 'rotate-[-56deg]', 'rotate-[-53deg]', 'rotate-[-50deg]', 'rotate-[-47deg]', 'rotate-[-44deg]', 'rotate-[-41deg]', 'rotate-[-38deg]', 'rotate-[-35deg]', 'rotate-[-32deg]', 'rotate-[-29deg]', 'rotate-[-26deg]', 'rotate-[-23deg]', 'rotate-[-20deg]', 'rotate-[-17deg]', 'rotate-[-14deg]', 'rotate-[-11deg]', 'rotate-[-8deg]', 'rotate-[-5deg]', 'rotate-[-2deg]', 'rotate-[1deg]', 'rotate-[4deg]', 'rotate-[7deg]', 'rotate-[10deg]', 'rotate-[13deg]', 'rotate-[16deg]', 'rotate-[19deg]', 'rotate-[22deg]', 'rotate-[25deg]', 'rotate-[28deg]', 'rotate-[31deg]', 'rotate-[34deg]', 'rotate-[37deg]', 'rotate-[40deg]', 'rotate-[43deg]', 'rotate-[46deg]', 'rotate-[49deg]', 'rotate-[52deg]', 'rotate-[55deg]', 'rotate-[58deg]', 'rotate-[61deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-63deg]', 'rotate-[-60deg]', 'rotate-[-57deg]', 'rotate-[-54deg]', 'rotate-[-51deg]', 'rotate-[-48deg]', 'rotate-[-45deg]', 'rotate-[-42deg]', 'rotate-[-39deg]', 'rotate-[-36deg]', 'rotate-[-33deg]', 'rotate-[-30deg]', 'rotate-[-27deg]', 'rotate-[-24deg]', 'rotate-[-21deg]', 'rotate-[-18deg]', 'rotate-[-15deg]', 'rotate-[-12deg]', 'rotate-[-9deg]', 'rotate-[-6deg]', 'rotate-[-3deg]', 'rotate-[0deg]', 'rotate-[2deg]', 'rotate-[5deg]', 'rotate-[8deg]', 'rotate-[11deg]', 'rotate-[14deg]', 'rotate-[17deg]', 'rotate-[20deg]', 'rotate-[23deg]', 'rotate-[26deg]', 'rotate-[29deg]', 'rotate-[32deg]', 'rotate-[35deg]', 'rotate-[38deg]', 'rotate-[41deg]', 'rotate-[44deg]', 'rotate-[47deg]', 'rotate-[50deg]', 'rotate-[53deg]', 'rotate-[56deg]', 'rotate-[59deg]', 'rotate-[62deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-63deg]', 'rotate-[-60deg]', 'rotate-[-57deg]', 'rotate-[-54deg]', 'rotate-[-51deg]', 'rotate-[-48deg]', 'rotate-[-45deg]', 'rotate-[-42deg]', 'rotate-[-39deg]', 'rotate-[-37deg]', 'rotate-[-34deg]', 'rotate-[-31deg]', 'rotate-[-28deg]', 'rotate-[-25deg]', 'rotate-[-22deg]', 'rotate-[-19deg]', 'rotate-[-16deg]', 'rotate-[-13deg]', 'rotate-[-11deg]', 'rotate-[-8deg]', 'rotate-[-5deg]', 'rotate-[-2deg]', 'rotate-[1deg]', 'rotate-[4deg]', 'rotate-[7deg]', 'rotate-[10deg]', 'rotate-[13deg]', 'rotate-[15deg]', 'rotate-[18deg]', 'rotate-[21deg]', 'rotate-[24deg]', 'rotate-[27deg]', 'rotate-[30deg]', 'rotate-[33deg]', 'rotate-[36deg]', 'rotate-[39deg]', 'rotate-[41deg]', 'rotate-[44deg]', 'rotate-[47deg]', 'rotate-[50deg]', 'rotate-[53deg]', 'rotate-[56deg]', 'rotate-[59deg]', 'rotate-[62deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-63deg]', 'rotate-[-60deg]', 'rotate-[-57deg]', 'rotate-[-54deg]', 'rotate-[-51deg]', 'rotate-[-49deg]', 'rotate-[-46deg]', 'rotate-[-43deg]', 'rotate-[-40deg]', 'rotate-[-37deg]', 'rotate-[-34deg]', 'rotate-[-32deg]', 'rotate-[-29deg]', 'rotate-[-26deg]', 'rotate-[-23deg]', 'rotate-[-20deg]', 'rotate-[-17deg]', 'rotate-[-15deg]', 'rotate-[-12deg]', 'rotate-[-9deg]', 'rotate-[-6deg]', 'rotate-[-3deg]', 'rotate-[0deg]', 'rotate-[2deg]', 'rotate-[5deg]', 'rotate-[8deg]', 'rotate-[11deg]', 'rotate-[14deg]', 'rotate-[16deg]', 'rotate-[19deg]', 'rotate-[22deg]', 'rotate-[25deg]', 'rotate-[28deg]', 'rotate-[31deg]', 'rotate-[33deg]', 'rotate-[36deg]', 'rotate-[39deg]', 'rotate-[42deg]', 'rotate-[45deg]', 'rotate-[48deg]', 'rotate-[50deg]', 'rotate-[53deg]', 'rotate-[56deg]', 'rotate-[59deg]', 'rotate-[62deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-63deg]', 'rotate-[-60deg]', 'rotate-[-57deg]', 'rotate-[-54deg]', 'rotate-[-52deg]', 'rotate-[-49deg]', 'rotate-[-46deg]', 'rotate-[-43deg]', 'rotate-[-41deg]', 'rotate-[-38deg]', 'rotate-[-35deg]', 'rotate-[-32deg]', 'rotate-[-30deg]', 'rotate-[-27deg]', 'rotate-[-24deg]', 'rotate-[-21deg]', 'rotate-[-18deg]', 'rotate-[-16deg]', 'rotate-[-13deg]', 'rotate-[-10deg]', 'rotate-[-7deg]', 'rotate-[-5deg]', 'rotate-[-2deg]', 'rotate-[1deg]', 'rotate-[4deg]', 'rotate-[6deg]', 'rotate-[9deg]', 'rotate-[12deg]', 'rotate-[15deg]', 'rotate-[17deg]', 'rotate-[20deg]', 'rotate-[23deg]', 'rotate-[26deg]', 'rotate-[29deg]', 'rotate-[31deg]', 'rotate-[34deg]', 'rotate-[37deg]', 'rotate-[40deg]', 'rotate-[42deg]', 'rotate-[45deg]', 'rotate-[48deg]', 'rotate-[51deg]', 'rotate-[53deg]', 'rotate-[56deg]', 'rotate-[59deg]', 'rotate-[62deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-63deg]', 'rotate-[-60deg]', 'rotate-[-57deg]', 'rotate-[-55deg]', 'rotate-[-52deg]', 'rotate-[-49deg]', 'rotate-[-47deg]', 'rotate-[-44deg]', 'rotate-[-41deg]', 'rotate-[-38deg]', 'rotate-[-36deg]', 'rotate-[-33deg]', 'rotate-[-30deg]', 'rotate-[-28deg]', 'rotate-[-25deg]', 'rotate-[-22deg]', 'rotate-[-19deg]', 'rotate-[-17deg]', 'rotate-[-14deg]', 'rotate-[-11deg]', 'rotate-[-9deg]', 'rotate-[-6deg]', 'rotate-[-3deg]', 'rotate-[0deg]', 'rotate-[2deg]', 'rotate-[5deg]', 'rotate-[8deg]', 'rotate-[10deg]', 'rotate-[13deg]', 'rotate-[16deg]', 'rotate-[18deg]', 'rotate-[21deg]', 'rotate-[24deg]', 'rotate-[27deg]', 'rotate-[29deg]', 'rotate-[32deg]', 'rotate-[35deg]', 'rotate-[37deg]', 'rotate-[40deg]', 'rotate-[43deg]', 'rotate-[46deg]', 'rotate-[48deg]', 'rotate-[51deg]', 'rotate-[54deg]', 'rotate-[56deg]', 'rotate-[59deg]', 'rotate-[62deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-63deg]', 'rotate-[-60deg]', 'rotate-[-58deg]', 'rotate-[-55deg]', 'rotate-[-52deg]', 'rotate-[-50deg]', 'rotate-[-47deg]', 'rotate-[-44deg]', 'rotate-[-42deg]', 'rotate-[-39deg]', 'rotate-[-36deg]', 'rotate-[-34deg]', 'rotate-[-31deg]', 'rotate-[-28deg]', 'rotate-[-26deg]', 'rotate-[-23deg]', 'rotate-[-20deg]', 'rotate-[-18deg]', 'rotate-[-15deg]', 'rotate-[-12deg]', 'rotate-[-10deg]', 'rotate-[-7deg]', 'rotate-[-4deg]', 'rotate-[-2deg]', 'rotate-[1deg]', 'rotate-[3deg]', 'rotate-[6deg]', 'rotate-[9deg]', 'rotate-[11deg]', 'rotate-[14deg]', 'rotate-[17deg]', 'rotate-[19deg]', 'rotate-[22deg]', 'rotate-[25deg]', 'rotate-[27deg]', 'rotate-[30deg]', 'rotate-[33deg]', 'rotate-[35deg]', 'rotate-[38deg]', 'rotate-[41deg]', 'rotate-[43deg]', 'rotate-[46deg]', 'rotate-[49deg]', 'rotate-[51deg]', 'rotate-[54deg]', 'rotate-[57deg]', 'rotate-[59deg]', 'rotate-[62deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-63deg]', 'rotate-[-60deg]', 'rotate-[-58deg]', 'rotate-[-55deg]', 'rotate-[-52deg]', 'rotate-[-50deg]', 'rotate-[-47deg]', 'rotate-[-45deg]', 'rotate-[-42deg]', 'rotate-[-39deg]', 'rotate-[-37deg]', 'rotate-[-34deg]', 'rotate-[-32deg]', 'rotate-[-29deg]', 'rotate-[-26deg]', 'rotate-[-24deg]', 'rotate-[-21deg]', 'rotate-[-19deg]', 'rotate-[-16deg]', 'rotate-[-13deg]', 'rotate-[-11deg]', 'rotate-[-8deg]', 'rotate-[-6deg]', 'rotate-[-3deg]', 'rotate-[0deg]', 'rotate-[2deg]', 'rotate-[5deg]', 'rotate-[7deg]', 'rotate-[10deg]', 'rotate-[13deg]', 'rotate-[15deg]', 'rotate-[18deg]', 'rotate-[20deg]', 'rotate-[23deg]', 'rotate-[26deg]', 'rotate-[28deg]', 'rotate-[31deg]', 'rotate-[33deg]', 'rotate-[36deg]', 'rotate-[39deg]', 'rotate-[41deg]', 'rotate-[44deg]', 'rotate-[46deg]', 'rotate-[49deg]', 'rotate-[52deg]', 'rotate-[54deg]', 'rotate-[57deg]', 'rotate-[59deg]', 'rotate-[62deg]', 'rotate-[65deg]', 'rotate-[-65deg]', 'rotate-[-63deg]', 'rotate-[-60deg]', 'rotate-[-58deg]', 'rotate-[-55deg]', 'rotate-[-53deg]', 'rotate-[-50deg]', 'rotate-[-48deg]', 'rotate-[-45deg]', 'rotate-[-43deg]', 'rotate-[-40deg]', 'rotate-[-37deg]', 'rotate-[-35deg]', 'rotate-[-32deg]', 'rotate-[-30deg]', 'rotate-[-27deg]', 'rotate-[-25deg]', 'rotate-[-22deg]', 'rotate-[-20deg]', 'rotate-[-17deg]', 'rotate-[-15deg]', 'rotate-[-12deg]', 'rotate-[-9deg]', 'rotate-[-7deg]', 'rotate-[-4deg]', 'rotate-[-2deg]', 'rotate-[1deg]', 'rotate-[3deg]', 'rotate-[6deg]', 'rotate-[8deg]', 'rotate-[11deg]', 'rotate-[14deg]', 'rotate-[16deg]', 'rotate-[19deg]', 'rotate-[21deg]', 'rotate-[24deg]', 'rotate-[26deg]', 'rotate-[29deg]', 'rotate-[31deg]', 'rotate-[34deg]', 'rotate-[36deg]', 'rotate-[39deg]', 'rotate-[42deg]', 'rotate-[44deg]', 'rotate-[47deg]', 'rotate-[49deg]', 'rotate-[52deg]', 'rotate-[54deg]', 'rotate-[57deg]', 'rotate-[59deg]', 'rotate-[62deg]', 'rotate-[65deg]', 'translate-y-40', 'translate-y-35', 'translate-y-30', 'translate-y-25', 'translate-y-20', 'translate-y-15', 'translate-y-10', 'translate-y-5', 'translate-y-0', 'translate-y-5', 'translate-y-10', 'translate-y-15', 'translate-y-20', 'translate-y-25', 'translate-y-30', 'translate-y-35', 'translate-y-40',
];

const verticalOffsets = [
  '-translate-y-[0.3333rem]', // 0.5 / 1.5
  '-translate-y-[0.5rem]', // 0.75 / 1.5
  '-translate-y-[0.6667rem]', // 1 / 1.5
  '-translate-y-[0.8333rem]', // 1.25 / 1.5
  '-translate-y-[1rem]', // 1.5 / 1.5
  '-translate-y-[1.1667rem]', // 1.75 / 1.5
  '-translate-y-[1.3333rem]', // 2 / 1.5
  '-translate-y-[1.4667rem]', // 2.2 / 1.5
  '-translate-y-[1.5333rem]', // 2.3 / 1.5
  '-translate-y-[1.6333rem]', // 2.45 / 1.5
  '-translate-y-[1.6333rem]', // 2.45 / 1.5
  '-translate-y-[1.5333rem]', // 2.3 / 1.5
  '-translate-y-[1.4667rem]', // 2.2 / 1.5
  '-translate-y-[1.3333rem]', // 2 / 1.5
  '-translate-y-[1.1667rem]', // 1.75 / 1.5
  '-translate-y-[1rem]', // 1.5 / 1.5
  '-translate-y-[0.8333rem]', // 1.25 / 1.5
  '-translate-y-[0.6667rem]', // 1 / 1.5
  '-translate-y-[0.5rem]', // 0.75 / 1.5
  '-translate-y-[0.3333rem]', // 0.5 / 1.5
];
const judgementGameStore = useJudgementGame();
const { judgementGame, tableCards } = storeToRefs(judgementGameStore);
const el = ref<HTMLElement | null>(null);
const cardMoveStore = useCardMove();
const { setCardCoord, decrementCardsOnHandCount, setCardCoordsAtIndex, setIsOverTable, setIsDragged } = cardMoveStore;
const { cardCoord, isOverTable, isDragged } = storeToRefs(cardMoveStore);
const { x, y, style } = useDraggable(el, {
  initialValue: { x: cardCoord.value.x, y: cardCoord.value.y },
});
const draggedClassList = ref('fixed z-50');
const onTablePosition = `left: ${cardCoord.value.x}px; top: ${cardCoord.value.y}px;`;

onMounted(() => {
  setCardCoordsAtIndex(props.index, el);
  if (props.card?.hasBeenPlayed)
    setIsOverTable(false);
});

const rotationClass = computed(() => {
  return (`rotate-[${props.rotation}deg]`);
});
const staticClassList = ref(`${verticalOffsets[props.index + props.offsetCoeff]} z-30 hover:z-50 hover:translate-x-[-10px] hover:rotate-[0deg] hover:scale-125 hover:-translate-y-[2.8rem] transition-transform duration-200 ease-in-out`);

const dynamicStyle = computed(() => {
  return props.card?.hasBeenPlayed && !isDragged.value ? onTablePosition : style.value;
});

function handleDragStart(event: MouseEvent) {
  x.value = event.clientX;
  y.value = event.clientY;
  setIsDragged(true);
  emit('onMouseDown', props.card!, props.index);
  document.addEventListener('mouseup', handleDrop);
}
function handleDrop() {
  if (!tableCards.value.includes(props.card!)) {
    setIsDragged(false);
    setCardCoord(el);
    judgementGame.value!.players[0].playerCards.splice(props.index, 1);
    const playedCard = {
      ...props.card!,
      hasBeenPlayed: true,
    };
    tableCards.value.push(playedCard);
    decrementCardsOnHandCount();
  }
  document.removeEventListener('mouseup', handleDrop);
}

watch([x, y], () => {
  if (!props.card?.hasBeenPlayed)
    setCardCoord(el);
});
</script>

<template>
  <img
    :id="props.card?.name"
    ref="el"
    :src="`/src/assets/cards/front/${props.card?.name}.svg`"
    :alt="`${props.card?.rank} of ${props.card?.suit}`"
    class=" mx-[-25px] flex h-[130px] w-[90px] cursor-grab drop-shadow-[0_14px_28px_rgba(0,0,0,0.25)] transition-transform"
    :class="`${isDragged ? draggedClassList : (props.card?.hasBeenPlayed ? draggedClassList : `${staticClassList} ${rotationClass}`)}`"
    draggable="false"
    :style="dynamicStyle"
    @mousedown="(e: MouseEvent) => {
      if (!props.card?.hasBeenPlayed) {
        handleDragStart(e);
      }
    }"
  >
  <div
    v-if="isDragged"
    class=" z-30 mx-[-25px] flex min-h-[140px] min-w-[100px]"
    :class="` ${verticalOffsets[props.index + props.offsetCoeff]}`"
    draggable="false"
    style="opacity: 0.5; border: 2px dashed #000; transition: margin 200ms ease-in-out; transition: transform 200ms ease-in-out;"
  />
</template>
